(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=Object.prototype.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype;return a};a=function(){function a(){}a.hexToRGB=function(a){a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(a&65280)>>8,b:a&255}},a.hexToHSB=function(a){console.log(this.hexToRGB(a));return this.rgbToHSB(this.hexToRGB(a))},a.rgbToHSB=function(a){var b,c,d,e;c={h:0,s:0,b:0},e=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),b=d-e,c.b=d,c.s=d!==0?255*b/d:0,c.s!==0?a.r===d?c.h=(a.g-a.b)/b:a.g===d?c.h=2+(a.b-a.r)/b:c.h=4+(a.r-a.g)/b:c.h=-1,c.h*=60,c.h<0&&(c.h+=360),c.s*=100/255,c.b*=100/255;return c},a.hsbToRGB=function(a){var b,c,d,e,f,g,h;c={},b=Math.round(a.h),d=Math.round(a.s*255/100),h=Math.round(a.b*255/100),d===0?c.r=c.g=c.b=h:(e=h,f=(255-d)*h/255,g=(e-f)*(b%60)/60,b===360&&(b=0),b<60?(c.r=e,c.b=f,c.g=f+g):b<120?(c.g=e,c.b=f,c.r=e-g):b<180?(c.g=e,c.r=f,c.b=f+g):b<240?(c.b=e,c.r=f,c.g=e-g):b<300?(c.b=e,c.g=f,c.r=f+g):b<360?(c.r=e,c.g=f,c.b=e-g):(c.r=0,c.g=0,c.b=0));return{r:Math.round(c.r),g:Math.round(c.g),b:Math.round(c.b)}},a.hsbToHex=function(a){return this.rgbToHex(this.hsbToRGB(a))},a.rgbToHex=function(a){var b;b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)],$.each(b,function(a,c){if(c.length===1)return b[a]="0"+c});return b.join("")};return a}(),b='<div class="colorpicker_nav">\n    <a class="colorpicker_accept" href="#">&#x2714;</a>\n    <a class="colorpicker_cancel" href="#">&#x2718;</a>\n</div>\n<div class="colorpicker_color" style="background-color: rgb(255, 0, 0); ">\n    <div>\n        <div></div>\n    </div>\n    <div class="alpha_channel"></div>\n</div>\n\n<div class="colorpicker_hue">\n    <div style="top: 150px; ">\n    </div>\n</div>\n\n<div class="colorpicker_fields">\n    <div class="rgb_row">\n        <div class="colorpicker_rgb_r">\n        <label>R</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value="<%= r %>">\n        </div>\n        <div class="colorpicker_rgb_g">\n        <label>G</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value="<%= g %>">\n        </div>\n        <div class="colorpicker_rgb_b">\n        <label>B</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value="<%= b %>">\n        </div>\n        <div class="colorpicker_rgb_a">\n        <label>A</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value=""><label>%</label>\n        </div>\n    </div>\n\n    <div class="hex_row">\n        <div class="button_wrap">\n        <a href="#"></a>\n        </div>\n        <div>\n            <label>#</label>\n            <input class="hex" type="text" maxlength="6" size="6" value="<%= hex %>">\n        </div>\n    </div>\n\n    </div>\n</div>',this.ColorPicker=function(){function d(){this.clearOpacity=c(this.clearOpacity,this),this.changeAlpha=c(this.changeAlpha,this),this.upSelector=c(this.upSelector,this),this.moveSelector=c(this.moveSelector,this),this.downSelector=c(this.downSelector,this),this.upHue=c(this.upHue,this),this.moveHue=c(this.moveHue,this),this.downHue=c(this.downHue,this),this.change=c(this.change,this),this.setHex=c(this.setHex,this),this.setRGB=c(this.setRGB,this),this.getRGB=c(this.getRGB,this),this.setHue=c(this.setHue,this),this.setPalette=c(this.setPalette,this),this.render=c(this.render,this),this.accept=c(this.accept,this),this.cancel=c(this.cancel,this),this.close=c(this.close,this),this.open=c(this.open,this),d.__super__.constructor.apply(this,arguments)}e(d,Backbone.View),d.prototype.tagName="div",d.prototype.className="colorpicker",d.prototype.events={"mousedown div.colorpicker_hue":"downHue","mousedown div.colorpicker_color":"downSelector","change input":"change","keyup div.colorpicker_rgb_a input":"changeAlpha","click div.button_wrap a":"clearOpacity","click a.colorpicker_cancel":"cancel","click a.colorpicker_accept":"accept"},d.prototype.onChange=function(){},d.prototype.onCancel=function(){},d.prototype.onAccept=function(){},d.prototype.initialize=function(){var b,c,d,e,f,g;g=this.options,f=g.r,e=g.g,c=g.b,b=g.a,d=g.button,this.hsb=a.rgbToHSB({r:f,g:e,b:c}),this.original_hsb=_.clone(this.hsb),this.original_alpha=b,$(d).click(this.open),this.render(),this.$("div.colorpicker_rgb_a input").val(b).trigger("keyup"),$("body").append(this.el);return this.close()},d.prototype.open=function(a){var b,c,d,e,f,g;a&&a.preventDefault(),e=a.target,d=$(e).offset(),c=document.compatMode==="CSS1Compat",g={l:window.pageXOffset||(c?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(c?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(c?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(c?document.documentElement.clientHeight:document.body.clientHeight)},f=d.top+e.offsetHeight,b=d.left,f+175>g.t+g.h&&(f-=e.offsetHeight+175),b+320>g.l+g.w&&(b-=320),$(this.el).css({left:b+"px",top:f+"px"});return $(this.el).show()},d.prototype.close=function(){return $(this.el).hide()},d.prototype.cancel=function(a){this.hsb=_.clone(this.original_hsb),this.$("div.colorpicker_rgb_a input").val(this.original_alpha).trigger("keyup"),this.change(a);return this.close()},d.prototype.accept=function(){this.original_hsb=_.clone(this.hsb),this.original_alpha=this.$("div.colorpicker_rgb_a input").val(),this.close();return this.onAccept.call(this,this.getRGB(),a.hsbToHex(this.hsb,this.$("div.colorpicker_rgb_a input").val()))},d.prototype.render=function(){var c,d;d=_.template(b),c=a.hsbToRGB(this.hsb),c.hex=a.hsbToHex(this.hsb),$(this.el).html(d(c)),this.change();return this},d.prototype.setPalette=function(){var b;b=this.hsb,this.$("div.colorpicker_color").css("backgroundColor","#"+a.hsbToHex({h:b.h,s:100,b:100}));return this.$("div.colorpicker_color div div").css({left:parseInt(150*b.s/100,10),top:parseInt(150*(100-b.b)/100,10)})},d.prototype.setHue=function(){var a;a=this.hsb;return this.$("div.colorpicker_hue div").css("top",parseInt(150-150*a.h/360,10))},d.prototype.getRGB=function(){var a;a=this.$("div.rgb_row input");return{r:parseInt(a.eq(0).val(),10),g:parseInt(a.eq(1).val(),10),b:parseInt(a.eq(2).val(),10)}},d.prototype.setRGB=function(){var b;b=a.hsbToRGB(this.hsb);return this.$("div.rgb_row input").eq(0).val(b.r).end().eq(1).val(b.g).end().eq(2).val(b.b).end()},d.prototype.setHex=function(){return this.$("input.hex").val(a.hsbToHex(this.hsb))},d.prototype.change=function(b){var c,d;b&&(c=$(b.target),d=c.attr("class"),d==="hex"?this.hsb=a.hexToHSB(c.val()):d==="rgb"&&(this.hsb=a.rgbToHSB(this.getRGB()))),this.setRGB(),this.setHex(),this.setPalette(),this.setHue();if(b)return this.onChange.call(this,this.getRGB(),a.hsbToHex(this.hsb,this.$("div.colorpicker_rgb_a input").val()))},d.prototype.downHue=function(a){var b;a.preventDefault(),b={y:$(a.target).offset().top},$(document).bind("mouseup",b,this.upHue);return $(document).bind("mousemove",b,this.moveHue)},d.prototype.moveHue=function(a){a.preventDefault(),this.hsb.h=parseInt(360*((150-Math.max(0,Math.min(150,a.pageY-a.data.y)))/150),10);return this.change(a)},d.prototype.upHue=function(a){a.preventDefault(),this.setRGB(),this.setHex(),$(document).unbind("mouseup",this.upHue);return $(document).unbind("mousemove",this.moveHue)},d.prototype.downSelector=function(a){var b;a.preventDefault(),b={pos:$(a.target).offset()},$(document).bind("mouseup",b,this.upSelector);return $(document).bind("mousemove",b,this.moveSelector)},d.prototype.moveSelector=function(a){a.preventDefault(),this.hsb.b=parseInt(100*((150-Math.max(0,Math.min(150,a.pageY-a.data.pos.top)))/150),10),this.hsb.s=parseInt(100*Math.max(0,Math.min(150,a.pageX-a.data.pos.left))/150,10);return this.change(a)},d.prototype.upSelector=function(a){a.preventDefault(),this.setRGB(),this.setHex(),$(document).unbind("mouseup",this.upSelector);return $(document).unbind("mousemove",this.moveSelector)},d.prototype.changeAlpha=function(a){var b,c,d;c=Number($(a.target).val()),d=a.keyCode;if(d===38||d===40)b=!0,d===38?c+=1:d===40&&(c-=1);c>100?c=100:c<0&&(c=0),b!=null&&$(a.target).val(c);return this.$("div.alpha_channel").fadeTo(0,(100-c)/100)},d.prototype.clearOpacity=function(a){a.preventDefault();return this.$("div.colorpicker_rgb_a input").val("0").trigger("keyup")};return d}()}).call(this)