(function(){var a,b,c,d=Object.prototype.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype;return a},f=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(){}a.hexToRGB=function(a){a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(a&65280)>>8,b:a&255}},a.hexToHSB=function(a){console.log(this.hexToRGB(a));return this.rgbToHSB(this.hexToRGB(a))},a.rgbToHSB=function(a){var b,c,d,e;c={h:0,s:0,b:0},e=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),b=d-e,c.b=d,c.s=d!==0?255*b/d:0,c.s!==0?a.r===d?c.h=(a.g-a.b)/b:a.g===d?c.h=2+(a.b-a.r)/b:c.h=4+(a.r-a.g)/b:c.h=-1,c.h*=60,c.h<0&&(c.h+=360),c.s*=100/255,c.b*=100/255;return c},a.hsbToRGB=function(a){var b,c,d,e,f,g,h;c={},b=Math.round(a.h),d=Math.round(a.s*255/100),h=Math.round(a.b*255/100),d===0?c.r=c.g=c.b=h:(e=h,f=(255-d)*h/255,g=(e-f)*(b%60)/60,b===360&&(b=0),b<60?(c.r=e,c.b=f,c.g=f+g):b<120?(c.g=e,c.b=f,c.r=e-g):b<180?(c.g=e,c.r=f,c.b=f+g):b<240?(c.b=e,c.r=f,c.g=e-g):b<300?(c.b=e,c.g=f,c.r=f+g):b<360?(c.r=e,c.g=f,c.b=e-g):(c.r=0,c.g=0,c.b=0));return{r:Math.round(c.r),g:Math.round(c.g),b:Math.round(c.b)}},a.hsbToHex=function(a){return this.rgbToHex(this.hsbToRGB(a))},a.rgbToHex=function(a){var b;b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)],$.each(b,function(a,c){if(c.length===1)return b[a]="0"+c});return b.join("")};return a}(),c='<div class="colorpicker_nav">\n    <a class="colorpicker_accept" href="#">&#x2714;</a>\n    <a class="colorpicker_cancel" href="#">&#x2718;</a>\n</div>\n<div class="colorpicker_color" style="background-color: rgb(255, 0, 0); ">\n    <div>\n        <div></div>\n    </div>\n    <div class="alpha_channel"></div>\n</div>\n\n<div class="colorpicker_hue">\n    <div style="top: 150px; ">\n    </div>\n</div>\n\n<div class="colorpicker_fields">\n    <div class="rgb_row">\n        <div class="colorpicker_rgb_r">\n        <label>R</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value="<%= r %>" />\n        </div>\n        <div class="colorpicker_rgb_g">\n        <label>G</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value="<%= g %>" />\n        </div>\n        <div class="colorpicker_rgb_b">\n        <label>B</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value="<%= b %>" />\n        </div>\n        <div class="colorpicker_rgb_a">\n        <label>A</label>\n        <input class="rgb" type="text" maxlength="3" size="3" value="<%= a %>" /><label>%</label>\n        </div>\n    </div>\n\n    <div class="hex_row">\n        <div class="button_wrap">\n        <a href="#"></a>\n        </div>\n        <div>\n            <label>#</label>\n            <input class="hex" type="text" maxlength="6" size="6" value="<%= hex %>">\n        </div>\n    </div>\n\n    </div>\n</div>',b=function(){function a(){a.__super__.constructor.apply(this,arguments)}e(a,Backbone.Events);return a}(),this.ColorPicker=function(){function d(){this.clearOpacity=f(this.clearOpacity,this),this.changeAlpha=f(this.changeAlpha,this),this.upSelector=f(this.upSelector,this),this.moveSelector=f(this.moveSelector,this),this.downSelector=f(this.downSelector,this),this.upHue=f(this.upHue,this),this.moveHue=f(this.moveHue,this),this.downHue=f(this.downHue,this),this.change=f(this.change,this),this.setHex=f(this.setHex,this),this.setRGB=f(this.setRGB,this),this.getRGB=f(this.getRGB,this),this.setHue=f(this.setHue,this),this.setPalette=f(this.setPalette,this),this.render=f(this.render,this),this.blur=f(this.blur,this),this.accept=f(this.accept,this),this.cancel=f(this.cancel,this),this.close=f(this.close,this),this.open=f(this.open,this),d.__super__.constructor.apply(this,arguments)}e(d,Backbone.View),d.prototype.tagName="div",d.prototype.className="colorpicker",d.prototype.events={"mousedown div.colorpicker_hue":"downHue","mousedown div.colorpicker_color":"downSelector","change input":"change","keyup div.colorpicker_rgb_a input":"changeAlpha","click div.button_wrap a":"clearOpacity","click a.colorpicker_cancel":"cancel","click a.colorpicker_accept":"accept"},d.prototype.onChange=function(){},d.prototype.onCancel=function(){},d.prototype.onAccept=function(){},d.prototype.initialize=function(){var c,d,e,g,h,i;i=this.options,h=i.r,g=i.g,d=i.b,c=i.a,e=i.button,this.hsb=a.rgbToHSB({r:h,g:g,b:d}),this.original_hsb=_.clone(this.hsb),this.original_alpha=this.alpha=c,$(e).click(this.open),this.render(),this.$("div.colorpicker_rgb_a input").val(c).trigger("keyup"),$("body").append(this.el),this.close();return b.bind("open",f(function(a){if(this.open&&a!==this)return this.cancel(!0)},this))},d.prototype.open=function(a){var c,d,e,f,g,h;a&&a.preventDefault(),f=a.target,e=$(f).offset(),d=document.compatMode==="CSS1Compat",h={l:window.pageXOffset||(d?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(d?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(d?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(d?document.documentElement.clientHeight:document.body.clientHeight)},g=e.top+f.offsetHeight,c=e.left,g+175>h.t+h.h&&(g-=f.offsetHeight+175),c+320>h.l+h.w&&(c-=320),$(this.el).css({left:c+"px",top:g+"px"}),$(this.el).show(),b.trigger("open",this),this.open=!0;return $(document).bind("mousedown",this.blur)},d.prototype.close=function(){$(this.el).hide();return this.open=!1},d.prototype.cancel=function(a){var b;b=this.hsb,b=_.extend({},this.original_hsb),this.$("div.colorpicker_rgb_a input").val(this.original_alpha).trigger("keyup"),this.alpha=this.original_alpha,console.log(b,this.original_hsb),this.hsb=b,this.change(a);return this.close()},d.prototype.accept=function(){this.original_hsb=_.clone(this.hsb),this.original_alpha=this.$("div.colorpicker_rgb_a input").val(),this.close();return this.onAccept.call(this,this.getRGB(),a.hsbToHex(this.hsb),this.alpha)},d.prototype.blur=function(a){var b,c;c=a.target,b=this.el;if(c!==b&&$(b).find(c).length===0){$(document).unbind("mousedown");return this.close()}},d.prototype.render=function(){var b,d;d=_.template(c),b=a.hsbToRGB(this.hsb),b.hex=a.hsbToHex(this.hsb),b.a=this.original_alpha,$(this.el).html(d(b)),this.change();return this},d.prototype.setPalette=function(){var b;b=this.hsb,this.$("div.colorpicker_color").css("backgroundColor","#"+a.hsbToHex({h:b.h,s:100,b:100}));return this.$("div.colorpicker_color div div").css({left:parseInt(150*b.s/100,10),top:parseInt(150*(100-b.b)/100,10)})},d.prototype.setHue=function(){var a;a=this.hsb;return this.$("div.colorpicker_hue div").css("top",parseInt(150-150*a.h/360,10))},d.prototype.getRGB=function(){var a;a=this.$("div.rgb_row input");return{r:parseInt(a.eq(0).val(),10),g:parseInt(a.eq(1).val(),10),b:parseInt(a.eq(2).val(),10)}},d.prototype.setRGB=function(){var b;b=a.hsbToRGB(this.hsb);return this.$("div.rgb_row input").eq(0).val(b.r).end().eq(1).val(b.g).end().eq(2).val(b.b).end()},d.prototype.setHex=function(){return this.$("input.hex").val(a.hsbToHex(this.hsb))},d.prototype.change=function(b){var c,d;b&&(c=$(b.target),d=c.attr("class"),d==="hex"?this.hsb=a.hexToHSB(c.val()):d==="rgb"&&(this.hsb=a.rgbToHSB(this.getRGB()))),this.setRGB(),this.setHex(),this.setPalette(),this.setHue();if(b)return this.onChange.call(this,this.getRGB(),a.hsbToHex(this.hsb),this.alpha)},d.prototype.downHue=function(a){var b;a.preventDefault(),b={y:$(a.target).offset().top},$(document).bind("mouseup",b,this.upHue);return $(document).bind("mousemove",b,this.moveHue)},d.prototype.moveHue=function(a){a.preventDefault(),this.hsb.h=parseInt(360*((150-Math.max(0,Math.min(150,a.pageY-a.data.y)))/150),10);return this.change(a)},d.prototype.upHue=function(a){a.preventDefault(),this.setRGB(),this.setHex(),$(document).unbind("mouseup",this.upHue);return $(document).unbind("mousemove",this.moveHue)},d.prototype.downSelector=function(a){var b;a.preventDefault(),b={pos:$(a.target).offset()},$(document).bind("mouseup",b,this.upSelector);return $(document).bind("mousemove",b,this.moveSelector)},d.prototype.moveSelector=function(a){a.preventDefault(),this.hsb.b=parseInt(100*((150-Math.max(0,Math.min(150,a.pageY-a.data.pos.top)))/150),10),this.hsb.s=parseInt(100*Math.max(0,Math.min(150,a.pageX-a.data.pos.left))/150,10);return this.change(a)},d.prototype.upSelector=function(a){a.preventDefault(),this.setRGB(),this.setHex(),$(document).unbind("mouseup",this.upSelector);return $(document).unbind("mousemove",this.moveSelector)},d.prototype.changeAlpha=function(a){var b,c,d;c=Number($(a.target).val()),d=a.keyCode;if(d===38||d===40)b=!0,d===38?c+=1:d===40&&(c-=1);c>100?c=100:c<0&&(c=0),b!=null&&$(a.target).val(c),this.alpha=c,this.$("div.alpha_channel").fadeTo(0,(100-c)/100);return this.change(a)},d.prototype.clearOpacity=function(a){a.preventDefault();return this.$("div.colorpicker_rgb_a input").val("0").trigger("keyup")};return d}()}).call(this)